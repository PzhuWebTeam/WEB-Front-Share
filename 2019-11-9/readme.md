## XSS注入攻击

### 什么是XSS
- Cross-Site Scripting（跨站脚本攻击）简称 XSS，是一种代码注入攻击。攻击者通过在目标网站上注入恶意脚本，使之在用户的浏览器上运行。利用这些恶意脚本，攻击者可获取用户的敏感信息如 Cookie、SessionID 等，进而危害数据安全。
- 为了和 CSS 区分，这里把攻击的第一个字母改成了 X，于是叫做 XSS。

### XSS分类
### 反射型XSS攻击
- 反射型 XSS 的攻击步骤：
    - 1.攻击者构造出特殊的 URL，其中包含恶意代码。
    - 2.用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。
    - 3.用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
    - 4.恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

- 反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。
- 反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。
- 由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。
- POST 的内容也可以触发反射型 XSS，只不过其触发条件比较苛刻（需要构造表单提交页面，并引导用户点击），所以非常少见。

### 
- 如何预防呢？
- 额，这种攻击方式都快被浏览器给扼杀了，毕竟现在所有网页都对url上的特殊字符（""<>）进行了转码,至少我的四个浏览器（火狐，谷歌，ie， QQ（似乎就是谷歌和ie的集合？））都是这样
- 所有如何预防我也就不多加阐述，连浏览器都过不了真是太惨了。实在要防护，别人给你的链接不要随便乱点就好了，实在要点，你在一个什么信息都没有的浏览器打开应该也没有什么。



### 存储型XSS攻击
- 存储型 XSS 的攻击步骤：
    - 1.攻击者将恶意代码提交到目标网站的数据库中。
    - 2.用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。
    - 3.用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
    - 4.恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。
- 这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。


### DOM型XSS攻击
- DOM 型 XSS 的攻击步骤：
    - 1.攻击者构造出特殊的 URL，其中包含恶意代码。
    - 2.用户打开带有恶意代码的 URL。
    - 3.用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。
    - 4.恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。
- DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。


## XSS攻击的预防
### 输入过滤
- 前端过滤
- 后台过滤

### 预防存储型XSS攻击
- 存储型 XSS 都是在服务端取出恶意代码后，插入到响应 HTML 里的，攻击者刻意编写的“数据”被内嵌到“代码”中，被浏览器所执行。
- 预防这种漏洞，有两种常见做法：
    - 改成纯前端渲染，把代码和数据分隔开。（）
    - 对 HTML 做充分转义。（一般都不用HTML拼接，若实在要用，那就得用合适的转义库来转义，而且一般不要自己去写这个转义库，因为你一个人写的，肯定没有别人多次更新后的完整）

### 预防 DOM 型 XSS 攻击
- DOM 型 XSS 攻击，实际上就是网站前端 JavaScript 代码本身不够严谨，把不可信的数据当作代码执行了。
- 在使用 .innerHTML、.outerHTML、document.write() 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用 .textContent、.setAttribute() 等。
- 如果用 Vue/React 技术栈，避免使用v-html等
- DOM 中的内联事件监听器，如 location、onclick、onerror、onload、onmouseover 等，<a> 标签的 href 属性，JavaScript 的 eval()、setTimeout()、setInterval() 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。

## 其他的XSS防护措施
### 输入内容长度控制
- 对于不受信任的输入，都应该限定一个合理的长度。虽然无法完全防止 XSS 发生，但可以增加 XSS 攻击的难度。
### 其他安全措施
- HTTP-only Cookie: 禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie。
- 验证码：防止脚本冒充用户提交危险操作。